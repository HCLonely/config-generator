(async()=>{$(document).ready(()=>{$(window).scroll(function(){50<$(this).scrollTop()?$("#back2top").fadeIn():$("#back2top").fadeOut()}),$("#back2top").click(()=>(document.body.scrollIntoView(),!1)),new bootstrap.Tooltip($("#back2top")[0])});var e=Object.fromEntries(window.location.search.replace(/^\?/,"").split("&").map(e=>e.split("=")))["fileLink"],[t]=(e&&((t=new URL(decodeURIComponent(e))).search?t.search+="&time="+Date.now():t.search+="?time="+Date.now(),a(decodeURIComponent(e))),$("#file-selector"));async function a(e){const t=new bootstrap.Modal("#modal-loading");t.show();var[e,a]=await axios.get(e,{validateStatus:e=>200<=e&&e<400}).then(e=>[!0,e.data]).catch(e=>(console.error(e),[!1,e])),[r]=$("#modal-loading");r.addEventListener("shown.bs.modal",()=>{t.hide()}),t.hide(),e?n(a):o(a.message,"Get template file failed!")}function n(e){var e=function(e){try{var t=jsyaml.load(e);if(console.log(t),!Array.isArray(t))return o("The root template must be an array!"),!1;for(let e=0;e<t.length;e++){if(!t[e].name)return o(`The template of No.${e+1} has no the key: "name".`),!1;if(!t[e].body)return o(`The template of No.${e+1} has no the key: "body".`),!1;if(!t[e].type&&!t[e].filename)return o(`The template of No.${e+1} has no the keys: "type", "filename".
You have to input at least one of them.`),!1}return t}catch(e){return console.error(e),o(e.message),!1}}(e);e&&($("#file-selector,#loadRemoteFileLabel,#loadRemoteFileInput").hide(),e.forEach((a,e)=>{$("div.container").append(`<form id="config-${a.name}" style="display:none;" data-type="${a.type||a.filename.split(".").slice(0,-1).join(".")}" data-filename="${a.filename||a.name+"."+a.type}">
        ${a.quote?`<figure class="text-center" style="border: 1px dashed #00c9ff;border-radius: 5px;">
          <blockquote class="blockquote">
            <p>${a.quote}</p>
          </blockquote>
          ${a.author?`<figcaption class="blockquote-footer" style="margin-bottom: .5rem;">${a.author}</figcaption>`:""}
        </figure>`:""}
      </form>`),0===e&&($("#single-config-name>button").attr("data-name",a.name),$("#single-config-name>button").text(a.name),$("#config-"+a.name).show());e=$(`<li><a class="dropdown-item${0===e?" active":""}" href="javascript:void(0);">${a.name}</a></li>`);e.click(function(){var e=$(this).text().trim();$("#single-config-name>button").attr("data-name",e),$("#single-config-name>button").text(e),$("#single-config-name li>a").removeClass("active"),$(this).children("a").addClass("active"),$("form").hide(),$("#config-"+e).show()}),$("#single-config-name>ul").append(e),Object.entries(a.body).forEach(([e,t])=>{!function a(r,n,o,e){const t=r+"-"+n;if("text"===o.type)return"textarea"===o.inputType?void $("#config-"+r).append(`<div class="mb-3">
          <label for="${t}" class="form-label">
            ${o.name||n}${"array"===e&&!0===o.repeat?`<button type="button" class="btn btn-outline-primary repeat"
            data-id="${t}" data-name="${n}"
            style="--bs-btn-padding-y: 0rem; --bs-btn-padding-x: .3rem;--bs-btn-font-size: .55rem;border-radius: 50%;margin-left: .5rem;">+</button>`:""}
          </label>
          <textarea type="text" class="form-control item" id="${t}" name="${n}" data-parent="${r}"
            ${o.desp?` aria-describedby="help-${t}"`:""}
            ${o.placeholder?` placeholder="${o.placeholder}"`:""}
            ${o.required?" required":""}
            ${o.defaultValue?` value="${o.defaultValue}"`:""}
            ${o.validation?` data-validation="${o.validation}"`:""}
          ></textarea>
          ${o.validation?'<div class="invalid-feedback">Invalid format!</div>':""}
          ${o.desp?`<div id="help-${t}" class="form-text">${o.desp}</div>`:""}
        </div>`):void $("#config-"+r).append(`<div class="mb-3">
        <label for="${t}" class="form-label">${o.name||n}${"array"===e&&!0===o.repeat?`<button type="button"
          class="btn btn-outline-primary repeat" data-id="${t}" data-name="${n}"
          style="--bs-btn-padding-y: 0rem; --bs-btn-padding-x: .3rem;--bs-btn-font-size: .55rem;border-radius: 50%;margin-left: .5rem;">+</button>`:""}
        </label>
        <input type="${o.inputType||"text"}" class="form-control" id="${t}" name="${n}" data-parent="${r}"
          ${o.desp?` aria-describedby="help-${t}"`:""}
          ${o.placeholder?` placeholder="${o.placeholder}"`:""}
          ${o.required?" required":""}
          ${o.defaultValue?` value="${o.defaultValue}"`:""}
          ${o.validation?` data-validation="${o.validation}"`:""}
        />
        ${o.validation?'<div class="invalid-feedback">Invalid format!</div>':""}
        ${o.desp?`<div id="help-${t}" class="form-text">${o.desp}</div>`:""}
      </div>`);if("boolean"===o.type)return void $("#config-"+r).append(`<div class="form-check form-switch mb-3">
        <input class="form-check-input" type="checkbox" role="switch" id="${t}" name="${n}" data-parent="${r}"
          ${o.desp?` aria-describedby="help-${t}"`:""}
          ${o.defaultValue?' checked="checked"':""}
          />
        <label class="form-check-label" for="${t}">${o.name||n}${"array"===e&&!0===o.repeat?`<button type="button"
          class="btn btn-outline-primary repeat" data-id="${t}" data-name="${n}"
          style="--bs-btn-padding-y: 0rem; --bs-btn-padding-x: .3rem;--bs-btn-font-size: .55rem;border-radius: 50%;margin-left: .5rem;">+</button>`:""}
        </label>
        ${o.desp?`<div id="help-${t}" class="form-text">${o.desp}</div>`:""}
      </div>`);if("single-select"===o.type)return void $("#config-"+r).append(`<div class="mb-3">
        <label class="form-select-label" for="${t}">${o.name||n}${"array"===e&&!0===o.repeat?`<button type="button"
          class="btn btn-outline-primary repeat" data-id="${t}" data-name="${n}"
          style="--bs-btn-padding-y: 0rem; --bs-btn-padding-x: .3rem;--bs-btn-font-size: .55rem;border-radius: 50%;margin-left: .5rem;">+</button>`:""}
        </label>
        <select class="form-select" id="${t}" name="${n}" data-parent="${r}"
        ${o.desp?` aria-describedby="help-${t}"`:""}>
          ${o.options.map(e=>`<option value="${e}" ${e===o.defaultValue?" selected":""}>${e}</option>`).join("")}
        </select>
        ${o.desp?`<div id="help-${t}" class="form-text">${o.desp}</div>`:""}
      </div>`);if("multi-select"===o.type)return void $("#config-"+r).append(`<div class="mb-3">
        <label class="form-select-label" for="${t}">${o.name||n}${"array"===e&&!0===o.repeat?`<button type="button"
          class="btn btn-outline-primary repeat" data-id="${t}" data-name="${n}"
          style="--bs-btn-padding-y: 0rem; --bs-btn-padding-x: .3rem;--bs-btn-font-size: .55rem;border-radius: 50%;margin-left: .5rem;">+</button>`:""}
        </label>
        <select class="form-select" id="${t}" name="${n}" multiple data-parent="${r}"
        ${o.desp?` aria-describedby="help-${t}"`:""}>
          ${o.options.map(e=>`<option value="${e}"
          ${(o.defaultValue||[]).includes(e)?" selected":""}>${e}</option>`).join("")}
        </select>
        ${o.desp?`<div id="help-${t}" class="form-text">${o.desp}</div>`:""}
      </div>`);"object"===o.type&&($("#config-"+r).append(`<div class="card card-body" style="padding-bottom:0;margin-bottom:1rem;">
        <p style="text-align:center;margin-bottom:0;"">
          <a class="btn btn-primary" data-bs-toggle="collapse" href="#config-${r}-${n}" role="button" aria-expanded="true"
            aria-controls="config-${r}-${n}" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-custom-class="custom-tooltip"
            data-bs-title="Click to hide/show the options about ${o.name||n}.">
            ${o.name||n}
          </a>
          ${"array"===e&&!0===o.repeat?`<button type="button" class="btn btn-outline-primary repeat"
            data-id="config-${r}-${n}" data-name="${n}"
            style="--bs-btn-padding-y: 0rem; --bs-btn-padding-x: .3rem;--bs-btn-font-size: .55rem;border-radius: 50%;margin-left: .5rem;">+</button>`:""}
          ${o.desp?`<div id="configHelp-${r}-${n}" class="form-text">${o.desp}</div>`:""}
        </p><div id="config-${r}-${n}" class="collapse show" name="${n}" type="object" data-parent="${r}"></div>
      </div>`),Object.entries(o.body).forEach(([e,t])=>{a(r+"-"+n,e,t,o.type)}));if("array"===o.type){$("#config-"+r).append(`<div class="card card-body" style="padding-bottom:0;margin-bottom:1rem;">
        <p style="text-align:center;margin-bottom:0;">
          <a class="btn btn-primary" data-bs-toggle="collapse" href="#config-${r}-${n}" role="button" aria-expanded="true"
            aria-controls="config-${r}-${n}" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-custom-class="custom-tooltip"
            data-bs-title="Click to hide/show the options about ${o.name||n}.">
            ${o.name||n}
          </a>
          ${"array"===e&&!0===o.repeat?`<button type="button" class="btn btn-outline-primary repeat"
            data-id="config-${r}-${n}" data-name="${n}"
            style="--bs-btn-padding-y: 0rem; --bs-btn-padding-x: .3rem;--bs-btn-font-size: .55rem;border-radius: 50%;margin-left: .5rem;">+</button>`:""}
          ${o.desp?`<div id="configHelp-${r}-${n}" class="form-text">${o.desp}</div>`:""}
        </p><div id="config-${r}-${n}" class="collapse show" name="${n}" type="array" data-parent="${r}"></div>
      </div>`);const i=[];o.body.forEach(e=>{"number"==typeof e.repeat&&0<e.repeat?i.push(...new Array(e.repeat).fill(e)):i.push(e)}),i.forEach((e,t)=>{a(r+"-"+n,t,e,o.type)})}}(a.name,e,t)})}),$("button.repeat").on("click",d),e=$('<button class="btn btn-primary" type="submit" style="margin-bottom: 1rem;">Generator</button>'),$("form").append(e).submit(function(t){$(this).children('button[type="submit"]').attr("disabled","disabled").html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>Loading...'),t.target.checkValidity()||($(this).children('button[type="submit"]').text("Generator").removeAttr("disabled"),t.stopPropagation()),t.preventDefault();t=$(this);for(const e of $.makeArray(t.find("[data-validation]")))$(e).removeClass("is-invalid").removeClass("is-valid"),new RegExp($(e).attr("data-validation")).test($(e).val())||$(e).addClass("is-invalid");if(0<t.find(".is-invalid[data-validation]").length)$(this).children('button[type="submit"]').text("Generator").removeAttr("disabled"),t.find(".is-invalid[data-validation]")[0].scrollIntoView({behavior:"smooth"});else{var a=function r(e,n){const o=n?[]:{};e.find(`[data-parent="${e.attr("id").replace("config-","")}"]`).map((e,t)=>{if("object"===$(t).attr("type"))n?o.push(r($(t))):o[$(t).attr("name")]=r($(t));else if("array"===$(t).attr("type")){const a=r($(t),!0);n?o.push(a):o[$(t).attr("name")]=a}else"checkbox"===$(t).attr("type")?n?o.push($(t).prop("checked")):o[$(t).attr("name")]=$(t).prop("checked"):"number"===$(t).attr("type")?n?o.push(parseFloat($(t).val(),10)):o[$(t).attr("name")]=parseFloat($(t).val(),10):n?o.push($(t).val()):o[$(t).attr("name")]=$(t).val();return t});return o}(t);let e="";if(console.log(a),"json"===t.attr("data-type")&&(e=JSON.stringify(a,null,2)),["yml","yaml"].includes(t.attr("data-type"))&&(e=jsyaml.dump(a)),["ini"].includes(t.attr("data-type"))&&(e=function a(e,r=""){return Object.entries(e).map(([e,t])=>"object"==typeof t?a(t,""+r+e+"."):""+r+e+"="+t).join("\n")}(a)),"copy"===t.attr("data-filename"))$("#modalLabel").html('<span class="badge rounded-pill text-bg-success">Success</span>'),$("#modalBody>textarea").val(e),new bootstrap.Modal("#modal").show();else{var a=e,r=t.attr("data-filename"),t=t.attr("data-type");if(a=new Blob([a],{type:t}),window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(a,r);else{const n=document.createElement("a"),o=URL.createObjectURL(a);n.href=o,n.download=r,document.body.appendChild(n),n.click(),setTimeout(()=>{document.body.removeChild(n),window.URL.revokeObjectURL(o)},0)}}$(this).children('button[type="submit"]').text("Generator").removeAttr("disabled")}}))}function d(e){e=$(e.target).parent().parent();const r=e.children("div.collapse").attr("name"),o=e.parent().children().length,i=[new RegExp(r+"$"),o];var t=$(e.prop("outerHTML"));t.children().map((e,t)=>{var a=$(t).attr("id"),a=(a&&$(t).attr("id",a.replace(...i)),$(t).attr("name"));return a&&$(t).attr("name",o),t}),t.children("p").children("a").map((e,t)=>{var a=$(t).attr("href"),a=(a&&$(t).attr("href",a.replace(...i)),$(t).attr("aria-controls"));return a&&$(t).attr("aria-controls",a.replace(...i)),t}),t.children("p").children("button").map((e,t)=>{var a=$(t).attr("data-id"),a=(a&&$(t).attr("data-id",a.replace(...i)),$(t).attr("data-name"));return a&&$(t).attr("data-name",o),t}),t.children("div.collapse").children().map((e,t)=>{var a=$(t).children("[name]").attr("name");const n=[new RegExp(r+`-${a}$`),o+"-"+a];return $(t).children().map((e,t)=>{var a=$(t).attr("id"),r=(a&&$(t).attr("id",a.replace(...n)),$(t).attr("data-parent")),r=(r&&$(t).attr("data-parent",r.replace(...i)),$(t).attr("for")),r=(r&&$(t).attr("data-parent",r.replace(...n)),$(t).attr("aria-describedby"));return r&&$(t).attr("aria-describedby",a.replace(...n)),t}),t}),t.children().children("button.repeat").map((e,t)=>{var a=$(t).clone();return a.removeClass("repeat").addClass("delete-repeat").text("-").attr("style","--bs-btn-padding-y: .02rem; --bs-btn-padding-x: .39rem;--bs-btn-font-size: .55rem;border-radius: 50%;margin-left: .5rem;"),$(t).prev().hasClass("delete-repeat")&&$(t).prev().remove(),$(t).before(a),t}),e.after(t.prop("outerHTML")),$("button.delete-repeat").off("click").on("click",e=>{$(e.target).parent().parent().remove()}),$("button.repeat").off("click",d).on("click",d)}function o(e,t=""){$("#modalLabel").html('<span class="badge rounded-pill text-bg-danger">Error</span>'+(t||"")),$("#modalBody>textarea").val(e),new bootstrap.Modal("#modal").show()}function r(r){return new Promise((t,e)=>{var a=new FileReader;a.addEventListener("error",()=>{console.error("Error occurred reading file: "+r.name),e("Error occurred reading file: "+r.name)}),a.addEventListener("load",e=>{t(e.target.result)}),a.readAsText(r)})}t.addEventListener("dragover",e=>{e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"}),t.addEventListener("drop",async e=>{e.stopPropagation(),e.preventDefault();var e=e.dataTransfer.files;0<e.length&&((e=await r(e[0]).then(e=>e).catch(e=>(console.log(e),o(e),!1)))?n(e):o("The file content is empty!"))}),$("#readTemplateFile")[0].addEventListener("change",async e=>{0!==e.target.files.length&&((e=await r(e.target.files[0]).then(e=>e).catch(e=>(console.error(e),o(e),!1)))?n(e):o("The file content is empty!"))}),$("#loadRemoteFile").click(async e=>{var t=$("#remote-url").val();t&&($(e.target).attr("disabled","disabled").html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>Loading...'),await a(t),$(e.target).text("Generator").removeAttr("disabled"))})})();