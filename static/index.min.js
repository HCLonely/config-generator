(async()=>{var e,t=Object.fromEntries(window.location.search.replace(/^\?/,"").split("&").map(e=>e.split("="))).fileLink;function a(e,t=""){$("#modalLabel").html('<span class="badge rounded-pill text-bg-danger">Error</span>'+(t||"")),$("#modalBody>textarea").val(e);new bootstrap.Modal("#modal").show()}t&&([t,e]=await axios.get(t).then(e=>[!0,e.data]).catch(e=>(console.error(e),[!1,e])),t?(function(e){try{var t=jsyaml.load(e);if(console.log(t),!Array.isArray(t))return a("The root template must be an array!"),!1;for(let e=0;e<t.length;e++){if(!t[e].name)return a(`The template of No.${e+1} has no the key: "name".`),!1;if(!t[e].body)return a(`The template of No.${e+1} has no the key: "body".`),!1;if(!t[e].type&&!t[e].filename)return a(`The template of No.${e+1} has no the keys: "type", "filename".
You have to input at least one of them.`),!1}return t}catch(e){return console.error(e),a(e.message),!1}}(e).forEach((a,e)=>{$("div.container").append(`<form id="config-${a.name}" style="display:none;" data-type="${a.type||a.filename.split(".").slice(0,-1).join(".")}" data-filename="${a.filename||a.name+"."+a.type}"></form>`),0===e&&($("#single-config-name>button").attr("data-name",a.name),$("#single-config-name>button").text(a.name),$("#config-"+a.name).show());e=$(`<li><a class="dropdown-item${0===e?" active":""}" href="#">${a.name}</a></li>`);e.click(function(){var e=$(this).text().trim();$("#single-config-name>button").attr("data-name",e),$("#single-config-name>button").text(e),$("#single-config-name li>a").removeClass("active"),$(this).children("a").addClass("active"),$("form").hide(),$("#config-"+e).show()}),$("#single-config-name>ul").append(e),Object.entries(a.body).forEach(([e,t])=>{!function a(n,r,i,e){const t=n+"-"+r;if("text"===i.type)return"textarea"===i.inputType?void $("#config-"+n).append(`<div class="mb-3">
    <label for="${t}" class="form-label">${i.name||r}${"array"===e&&!0===i.repeat?`<button type="button" class="btn btn-outline-primary repeat" data-id="${t}" data-name="${r}" style="--bs-btn-padding-y: 0rem; --bs-btn-padding-x: .3rem;--bs-btn-font-size: .55rem;border-radius: 50%;margin-left: .5rem;">+</button>`:""}</label>
    <textarea type="text" class="form-control item" id="${t}" name="${r}" data-parent="${n}"
    ${i.desp?` aria-describedby="help-${t}"`:""}
    ${i.placeholder?` placeholder="${i.placeholder}"`:""}
    ${i.required?" required":""}
    ${i.defaultValue?` value="${i.defaultValue}"`:""}
    ${i.validation?` data-validation="${i.validation}"`:""}
    ></textarea>
    ${i.validation?'<div class="invalid-feedback">Invalid format!</div>':""}
    ${i.desp?`<div id="help-${t}" class="form-text">${i.desp}</div>`:""}
  </div>`):void $("#config-"+n).append(`<div class="mb-3">
    <label for="${t}" class="form-label">${i.name||r}${"array"===e&&!0===i.repeat?`<button type="button" class="btn btn-outline-primary repeat" data-id="${t}" data-name="${r}" style="--bs-btn-padding-y: 0rem; --bs-btn-padding-x: .3rem;--bs-btn-font-size: .55rem;border-radius: 50%;margin-left: .5rem;">+</button>`:""}</label>
    <input type="${i.inputType||"text"}" class="form-control" id="${t}" name="${r}" data-parent="${n}"
    ${i.desp?` aria-describedby="help-${t}"`:""}
    ${i.placeholder?` placeholder="${i.placeholder}"`:""}
    ${i.required?" required":""}
    ${i.defaultValue?` value="${i.defaultValue}"`:""}
    ${i.validation?` data-validation="${i.validation}"`:""}
    />
    ${i.validation?'<div class="invalid-feedback">Invalid format!</div>':""}
    ${i.desp?`<div id="help-${t}" class="form-text">${i.desp}</div>`:""}
  </div>`);if("boolean"===i.type)return void $("#config-"+n).append(`<div class="form-check form-switch mb-3">
  <input class="form-check-input" type="checkbox" role="switch" id="${t}" name="${r}" data-parent="${n}"
    ${i.desp?` aria-describedby="help-${t}"`:""}
    ${i.defaultValue?' checked="checked"':""}
    />
  <label class="form-check-label" for="${t}">${i.name||r}${"array"===e&&!0===i.repeat?`<button type="button" class="btn btn-outline-primary repeat" data-id="${t}" data-name="${r}" style="--bs-btn-padding-y: 0rem; --bs-btn-padding-x: .3rem;--bs-btn-font-size: .55rem;border-radius: 50%;margin-left: .5rem;">+</button>`:""}</label>
    ${i.desp?`<div id="help-${t}" class="form-text">${i.desp}</div>`:""}
</div>`);if("single-select"===i.type)return void $("#config-"+n).append(`<div class="mb-3">
      <label class="form-select-label" for="${t}">${i.name||r}${"array"===e&&!0===i.repeat?`<button type="button" class="btn btn-outline-primary repeat" data-id="${t}" data-name="${r}" style="--bs-btn-padding-y: 0rem; --bs-btn-padding-x: .3rem;--bs-btn-font-size: .55rem;border-radius: 50%;margin-left: .5rem;">+</button>`:""}</label>
      <select class="form-select" id="${t}" name="${r}" data-parent="${n}"
    ${i.desp?` aria-describedby="help-${t}"`:""}>
      ${i.options.map(e=>`<option value="${e}" ${e===i.defaultValue?" selected":""}>${e}</option>`).join("")}
</select>
    ${i.desp?`<div id="help-${t}" class="form-text">${i.desp}</div>`:""}
</div>`);if("multi-select"===i.type)return void $("#config-"+n).append(`<div class="mb-3">
      <label class="form-select-label" for="${t}">${i.name||r}${"array"===e&&!0===i.repeat?`<button type="button" class="btn btn-outline-primary repeat" data-id="${t}" data-name="${r}" style="--bs-btn-padding-y: 0rem; --bs-btn-padding-x: .3rem;--bs-btn-font-size: .55rem;border-radius: 50%;margin-left: .5rem;">+</button>`:""}</label>
      <select class="form-select" id="${t}" name="${r}" multiple data-parent="${n}"
    ${i.desp?` aria-describedby="help-${t}"`:""}>
      ${i.options.map(e=>`<option value="${e}" ${(i.defaultValue||[]).includes(e)?" selected":""}>${e}</option>`).join("")}
</select>
    ${i.desp?`<div id="help-${t}" class="form-text">${i.desp}</div>`:""}
</div>`);"object"===i.type&&($("#config-"+n).append(`<div class="card card-body" style="padding-bottom:0;margin-bottom:1rem;"><p style="text-align:center;margin-bottom:0;"">
  <a class="btn btn-primary" data-bs-toggle="collapse" href="#config-${n}-${r}" role="button" aria-expanded="true" aria-controls="config-${n}-${r}"
  data-bs-toggle="tooltip" data-bs-placement="top" data-bs-custom-class="custom-tooltip" data-bs-title="Click to hide/show the options about ${i.name||r}.">
    ${i.name||r}
  </a>
  ${"array"===e&&!0===i.repeat?`<button type="button" class="btn btn-outline-primary repeat" data-id="config-${n}-${r}" data-name="${r}" style="--bs-btn-padding-y: 0rem; --bs-btn-padding-x: .3rem;--bs-btn-font-size: .55rem;border-radius: 50%;margin-left: .5rem;">+</button>`:""}
    ${i.desp?`<div id="configHelp-${n}-${r}" class="form-text">${i.desp}</div>`:""}
</p><div id="config-${n}-${r}" class="collapse show" name="${r}" type="object" data-parent="${n}"></div></div>`),Object.entries(i.body).forEach(([e,t])=>{a(n+"-"+r,e,t,i.type)}));if("array"===i.type){$("#config-"+n).append(`<div class="card card-body" style="padding-bottom:0;margin-bottom:1rem;"><p style="text-align:center;margin-bottom:0;">
  <a class="btn btn-primary" data-bs-toggle="collapse" href="#config-${n}-${r}" role="button" aria-expanded="true" aria-controls="config-${n}-${r}"
  data-bs-toggle="tooltip" data-bs-placement="top" data-bs-custom-class="custom-tooltip" data-bs-title="Click to hide/show the options about ${i.name||r}.">
    ${i.name||r}
  </a>
  ${"array"===e&&!0===i.repeat?`<button type="button" class="btn btn-outline-primary repeat" data-id="config-${n}-${r}" data-name="${r}" style="--bs-btn-padding-y: 0rem; --bs-btn-padding-x: .3rem;--bs-btn-font-size: .55rem;border-radius: 50%;margin-left: .5rem;">+</button>`:""}
    ${i.desp?`<div id="configHelp-${n}-${r}" class="form-text">${i.desp}</div>`:""}
</p><div id="config-${n}-${r}" class="collapse show" name="${r}" type="array" data-parent="${n}"></div></div>`);const o=[];i.body.forEach((e,t)=>{"number"==typeof e.repeat&&0<e.repeat?o.push(...new Array(e.repeat).fill(e)):o.push(e)}),o.forEach((e,t)=>{a(n+"-"+r,t,e,i.type)})}}(a.name,e,t)})}),$("button.repeat").on("click",function e(t){parent=$(t.target).parent().parent();const a=$(t.target).attr("data-id");const n=parent.children("div.collapse").attr("name");const r=parent.parent().children().length;const d=[new RegExp(n+"$"),r];const i=$(parent.prop("outerHTML"));i.children().map((e,t)=>{const a=$(t).attr("id"),n=(a&&$(t).attr("id",a.replace(...d)),$(t).attr("name"));n&&$(t).attr("name",r)});i.children("p").children("a").map((e,t)=>{const a=$(t).attr("href"),n=(a&&$(t).attr("href",a.replace(...d)),$(t).attr("aria-controls"));n&&$(t).attr("aria-controls",n.replace(...d))});i.children("p").children("button").map((e,t)=>{const a=$(t).attr("data-id"),n=(a&&$(t).attr("data-id",a.replace(...d)),$(t).attr("data-name"));n&&$(t).attr("data-name",r)});i.children("div.collapse").children().map((e,t)=>{const a=$(t).children("[name]").attr("name"),o=[new RegExp(`${n}-${a}$`),r+"-"+a];$(t).children().map((e,t)=>{const a=$(t).attr("id"),n=(a&&$(t).attr("id",a.replace(...o)),$(t).attr("data-parent")),r=(n&&$(t).attr("data-parent",n.replace(...d)),$(t).attr("for")),i=(r&&$(t).attr("data-parent",r.replace(...o)),$(t).attr("aria-describedby"));i&&$(t).attr("aria-describedby",a.replace(...o))})});parent.after(i.prop("outerHTML"));$("button.repeat").off("click",e).on("click",e)}),t=$('<button class="btn btn-primary" type="submit" style="margin-bottom: 1rem;">Generator</button>'),$("form").append(t).submit(function(t){$(this).children('button[type="submit"]').attr("disabled","disabled").html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>Loading...'),t.target.checkValidity()||($(this).children('button[type="submit"]').text("Generator").removeAttr("disabled"),t.stopPropagation()),t.preventDefault();t=$(this);for(const e of $.makeArray(t.find("[data-validation]")))$(e).removeClass("is-invalid").removeClass("is-valid"),new RegExp($(e).attr("data-validation")).test($(e).val())||$(e).addClass("is-invalid");if(0<t.find(".is-invalid[data-validation]").length)$(this).children('button[type="submit"]').text("Generator").removeAttr("disabled"),t.find(".is-invalid[data-validation]")[0].scrollIntoView({behavior:"smooth"});else{var a=function n(e,r){const i=r?[]:{};e.find(`[data-parent="${e.attr("id").replace("config-","")}"]`).map((e,t)=>{if("object"===$(t).attr("type"))return r?void i.push(n($(t))):void(i[$(t).attr("name")]=n($(t)));if("array"!==$(t).attr("type"))return"checkbox"===$(t).attr("type")?r?void i.push($(t).prop("checked")):void(i[$(t).attr("name")]=$(t).prop("checked")):"number"===$(t).attr("type")?r?void i.push(parseFloat($(t).val(),10)):void(i[$(t).attr("name")]=parseFloat($(t).val(),10)):void(r?i.push($(t).val()):i[$(t).attr("name")]=$(t).val());{const a=n($(t),!0);return r?void i.push(a):void(i[$(t).attr("name")]=a)}});return i}(t);let e="";if(console.log(a),"json"===t.attr("data-type")&&(e=JSON.stringify(a,null,2)),["yml","yaml"].includes(t.attr("data-type"))&&(e=jsyaml.dump(a)),["ini"].includes(t.attr("data-type"))&&(e=function a(e,n=""){return Object.entries(e).map(([e,t])=>"object"==typeof t?a(t,""+n+e+"."):""+n+e+"="+t).join("\n")}(a)),"copy"===t.attr("data-filename")){$("#modalLabel").html('<span class="badge rounded-pill text-bg-success">Success</span>'),$("#modalBody>textarea").val(e);new bootstrap.Modal("#modal").show()}else{var a=e,n=t.attr("data-filename"),t=t.attr("data-type");if(a=new Blob([a],{type:t}),window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(a,n);else{const r=document.createElement("a"),i=URL.createObjectURL(a);r.href=i,r.download=n,document.body.appendChild(r),r.click(),setTimeout(function(){document.body.removeChild(r),window.URL.revokeObjectURL(i)},0)}}$(this).children('button[type="submit"]').text("Generator").removeAttr("disabled")}})):a(e.message,"Get template file failed!"))})();