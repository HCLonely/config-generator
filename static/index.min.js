(async()=>{var e=Object.fromEntries(window.location.search.replace(/^\?/,"").split("&").map(e=>e.split("=")))["fileLink"],[e]=(e&&a(decodeURIComponent(e)),$("#file-selector"));async function a(e){var[e,t]=await axios.get(e).then(e=>[!0,e.data]).catch(e=>(console.error(e),[!1,e]));e?r(t):i(t.message,"Get template file failed!")}function r(e){var e=function(e){try{var t=jsyaml.load(e);if(console.log(t),!Array.isArray(t))return i("The root template must be an array!"),!1;for(let e=0;e<t.length;e++){if(!t[e].name)return i(`The template of No.${e+1} has no the key: "name".`),!1;if(!t[e].body)return i(`The template of No.${e+1} has no the key: "body".`),!1;if(!t[e].type&&!t[e].filename)return i(`The template of No.${e+1} has no the keys: "type", "filename".
You have to input at least one of them.`),!1}return t}catch(e){return console.error(e),i(e.message),!1}}(e);e&&($("#file-selector,#loadRemoteFileLabel,#loadRemoteFileInput").hide(),e.forEach((a,e)=>{$("div.container").append(`<form id="config-${a.name}" style="display:none;" data-type="${a.type||a.filename.split(".").slice(0,-1).join(".")}" data-filename="${a.filename||a.name+"."+a.type}"></form>`),0===e&&($("#single-config-name>button").attr("data-name",a.name),$("#single-config-name>button").text(a.name),$("#config-"+a.name).show());e=$(`<li><a class="dropdown-item${0===e?" active":""}" href="#">${a.name}</a></li>`);e.click(function(){var e=$(this).text().trim();$("#single-config-name>button").attr("data-name",e),$("#single-config-name>button").text(e),$("#single-config-name li>a").removeClass("active"),$(this).children("a").addClass("active"),$("form").hide(),$("#config-"+e).show()}),$("#single-config-name>ul").append(e),Object.entries(a.body).forEach(([e,t])=>{!function a(r,n,i,e){const t=r+"-"+n;if("text"===i.type)return"textarea"===i.inputType?void $("#config-"+r).append(`<div class="mb-3">
          <label for="${t}" class="form-label">
            ${i.name||n}${"array"===e&&!0===i.repeat?`<button type="button" class="btn btn-outline-primary repeat"
            data-id="${t}" data-name="${n}"
            style="--bs-btn-padding-y: 0rem; --bs-btn-padding-x: .3rem;--bs-btn-font-size: .55rem;border-radius: 50%;margin-left: .5rem;">+</button>`:""}
          </label>
          <textarea type="text" class="form-control item" id="${t}" name="${n}" data-parent="${r}"
            ${i.desp?` aria-describedby="help-${t}"`:""}
            ${i.placeholder?` placeholder="${i.placeholder}"`:""}
            ${i.required?" required":""}
            ${i.defaultValue?` value="${i.defaultValue}"`:""}
            ${i.validation?` data-validation="${i.validation}"`:""}
          ></textarea>
          ${i.validation?'<div class="invalid-feedback">Invalid format!</div>':""}
          ${i.desp?`<div id="help-${t}" class="form-text">${i.desp}</div>`:""}
        </div>`):void $("#config-"+r).append(`<div class="mb-3">
        <label for="${t}" class="form-label">${i.name||n}${"array"===e&&!0===i.repeat?`<button type="button"
          class="btn btn-outline-primary repeat" data-id="${t}" data-name="${n}"
          style="--bs-btn-padding-y: 0rem; --bs-btn-padding-x: .3rem;--bs-btn-font-size: .55rem;border-radius: 50%;margin-left: .5rem;">+</button>`:""}
        </label>
        <input type="${i.inputType||"text"}" class="form-control" id="${t}" name="${n}" data-parent="${r}"
          ${i.desp?` aria-describedby="help-${t}"`:""}
          ${i.placeholder?` placeholder="${i.placeholder}"`:""}
          ${i.required?" required":""}
          ${i.defaultValue?` value="${i.defaultValue}"`:""}
          ${i.validation?` data-validation="${i.validation}"`:""}
        />
        ${i.validation?'<div class="invalid-feedback">Invalid format!</div>':""}
        ${i.desp?`<div id="help-${t}" class="form-text">${i.desp}</div>`:""}
      </div>`);if("boolean"===i.type)return void $("#config-"+r).append(`<div class="form-check form-switch mb-3">
        <input class="form-check-input" type="checkbox" role="switch" id="${t}" name="${n}" data-parent="${r}"
          ${i.desp?` aria-describedby="help-${t}"`:""}
          ${i.defaultValue?' checked="checked"':""}
          />
        <label class="form-check-label" for="${t}">${i.name||n}${"array"===e&&!0===i.repeat?`<button type="button"
          class="btn btn-outline-primary repeat" data-id="${t}" data-name="${n}"
          style="--bs-btn-padding-y: 0rem; --bs-btn-padding-x: .3rem;--bs-btn-font-size: .55rem;border-radius: 50%;margin-left: .5rem;">+</button>`:""}
        </label>
        ${i.desp?`<div id="help-${t}" class="form-text">${i.desp}</div>`:""}
      </div>`);if("single-select"===i.type)return void $("#config-"+r).append(`<div class="mb-3">
        <label class="form-select-label" for="${t}">${i.name||n}${"array"===e&&!0===i.repeat?`<button type="button"
          class="btn btn-outline-primary repeat" data-id="${t}" data-name="${n}"
          style="--bs-btn-padding-y: 0rem; --bs-btn-padding-x: .3rem;--bs-btn-font-size: .55rem;border-radius: 50%;margin-left: .5rem;">+</button>`:""}
        </label>
        <select class="form-select" id="${t}" name="${n}" data-parent="${r}"
        ${i.desp?` aria-describedby="help-${t}"`:""}>
          ${i.options.map(e=>`<option value="${e}" ${e===i.defaultValue?" selected":""}>${e}</option>`).join("")}
        </select>
        ${i.desp?`<div id="help-${t}" class="form-text">${i.desp}</div>`:""}
      </div>`);if("multi-select"===i.type)return void $("#config-"+r).append(`<div class="mb-3">
        <label class="form-select-label" for="${t}">${i.name||n}${"array"===e&&!0===i.repeat?`<button type="button"
          class="btn btn-outline-primary repeat" data-id="${t}" data-name="${n}"
          style="--bs-btn-padding-y: 0rem; --bs-btn-padding-x: .3rem;--bs-btn-font-size: .55rem;border-radius: 50%;margin-left: .5rem;">+</button>`:""}
        </label>
        <select class="form-select" id="${t}" name="${n}" multiple data-parent="${r}"
        ${i.desp?` aria-describedby="help-${t}"`:""}>
          ${i.options.map(e=>`<option value="${e}"
          ${(i.defaultValue||[]).includes(e)?" selected":""}>${e}</option>`).join("")}
        </select>
        ${i.desp?`<div id="help-${t}" class="form-text">${i.desp}</div>`:""}
      </div>`);"object"===i.type&&($("#config-"+r).append(`<div class="card card-body" style="padding-bottom:0;margin-bottom:1rem;">
        <p style="text-align:center;margin-bottom:0;"">
          <a class="btn btn-primary" data-bs-toggle="collapse" href="#config-${r}-${n}" role="button" aria-expanded="true"
            aria-controls="config-${r}-${n}" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-custom-class="custom-tooltip"
            data-bs-title="Click to hide/show the options about ${i.name||n}.">
            ${i.name||n}
          </a>
          ${"array"===e&&!0===i.repeat?`<button type="button" class="btn btn-outline-primary repeat"
            data-id="config-${r}-${n}" data-name="${n}"
            style="--bs-btn-padding-y: 0rem; --bs-btn-padding-x: .3rem;--bs-btn-font-size: .55rem;border-radius: 50%;margin-left: .5rem;">+</button>`:""}
          ${i.desp?`<div id="configHelp-${r}-${n}" class="form-text">${i.desp}</div>`:""}
        </p><div id="config-${r}-${n}" class="collapse show" name="${n}" type="object" data-parent="${r}"></div>
      </div>`),Object.entries(i.body).forEach(([e,t])=>{a(r+"-"+n,e,t,i.type)}));if("array"===i.type){$("#config-"+r).append(`<div class="card card-body" style="padding-bottom:0;margin-bottom:1rem;">
        <p style="text-align:center;margin-bottom:0;">
          <a class="btn btn-primary" data-bs-toggle="collapse" href="#config-${r}-${n}" role="button" aria-expanded="true"
            aria-controls="config-${r}-${n}" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-custom-class="custom-tooltip"
            data-bs-title="Click to hide/show the options about ${i.name||n}.">
            ${i.name||n}
          </a>
          ${"array"===e&&!0===i.repeat?`<button type="button" class="btn btn-outline-primary repeat"
            data-id="config-${r}-${n}" data-name="${n}"
            style="--bs-btn-padding-y: 0rem; --bs-btn-padding-x: .3rem;--bs-btn-font-size: .55rem;border-radius: 50%;margin-left: .5rem;">+</button>`:""}
          ${i.desp?`<div id="configHelp-${r}-${n}" class="form-text">${i.desp}</div>`:""}
        </p><div id="config-${r}-${n}" class="collapse show" name="${n}" type="array" data-parent="${r}"></div>
      </div>`);const o=[];i.body.forEach(e=>{"number"==typeof e.repeat&&0<e.repeat?o.push(...new Array(e.repeat).fill(e)):o.push(e)}),o.forEach((e,t)=>{a(r+"-"+n,t,e,i.type)})}}(a.name,e,t)})}),$("button.repeat").on("click",n),e=$('<button class="btn btn-primary" type="submit" style="margin-bottom: 1rem;">Generator</button>'),$("form").append(e).submit(function(t){$(this).children('button[type="submit"]').attr("disabled","disabled").html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>Loading...'),t.target.checkValidity()||($(this).children('button[type="submit"]').text("Generator").removeAttr("disabled"),t.stopPropagation()),t.preventDefault();t=$(this);for(const e of $.makeArray(t.find("[data-validation]")))$(e).removeClass("is-invalid").removeClass("is-valid"),new RegExp($(e).attr("data-validation")).test($(e).val())||$(e).addClass("is-invalid");if(0<t.find(".is-invalid[data-validation]").length)$(this).children('button[type="submit"]').text("Generator").removeAttr("disabled"),t.find(".is-invalid[data-validation]")[0].scrollIntoView({behavior:"smooth"});else{var a=function r(e,n){const i=n?[]:{};e.find(`[data-parent="${e.attr("id").replace("config-","")}"]`).map((e,t)=>{if("object"===$(t).attr("type"))n?i.push(r($(t))):i[$(t).attr("name")]=r($(t));else if("array"===$(t).attr("type")){const a=r($(t),!0);n?i.push(a):i[$(t).attr("name")]=a}else"checkbox"===$(t).attr("type")?n?i.push($(t).prop("checked")):i[$(t).attr("name")]=$(t).prop("checked"):"number"===$(t).attr("type")?n?i.push(parseFloat($(t).val(),10)):i[$(t).attr("name")]=parseFloat($(t).val(),10):n?i.push($(t).val()):i[$(t).attr("name")]=$(t).val();return t});return i}(t);let e="";if(console.log(a),"json"===t.attr("data-type")&&(e=JSON.stringify(a,null,2)),["yml","yaml"].includes(t.attr("data-type"))&&(e=jsyaml.dump(a)),["ini"].includes(t.attr("data-type"))&&(e=function a(e,r=""){return Object.entries(e).map(([e,t])=>"object"==typeof t?a(t,""+r+e+"."):""+r+e+"="+t).join("\n")}(a)),"copy"===t.attr("data-filename"))$("#modalLabel").html('<span class="badge rounded-pill text-bg-success">Success</span>'),$("#modalBody>textarea").val(e),new bootstrap.Modal("#modal").show();else{var a=e,r=t.attr("data-filename"),t=t.attr("data-type");if(a=new Blob([a],{type:t}),window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(a,r);else{const n=document.createElement("a"),i=URL.createObjectURL(a);n.href=i,n.download=r,document.body.appendChild(n),n.click(),setTimeout(()=>{document.body.removeChild(n),window.URL.revokeObjectURL(i)},0)}}$(this).children('button[type="submit"]').text("Generator").removeAttr("disabled")}}))}function n(e){e=$(e.target).parent().parent();const r=e.children("div.collapse").attr("name"),i=e.parent().children().length,o=[new RegExp(r+"$"),i];var t=$(e.prop("outerHTML"));t.children().map((e,t)=>{var a=$(t).attr("id"),a=(a&&$(t).attr("id",a.replace(...o)),$(t).attr("name"));return a&&$(t).attr("name",i),t}),t.children("p").children("a").map((e,t)=>{var a=$(t).attr("href"),a=(a&&$(t).attr("href",a.replace(...o)),$(t).attr("aria-controls"));return a&&$(t).attr("aria-controls",a.replace(...o)),t}),t.children("p").children("button").map((e,t)=>{var a=$(t).attr("data-id"),a=(a&&$(t).attr("data-id",a.replace(...o)),$(t).attr("data-name"));return a&&$(t).attr("data-name",i),t}),t.children("div.collapse").children().map((e,t)=>{var a=$(t).children("[name]").attr("name");const n=[new RegExp(r+`-${a}$`),i+"-"+a];return $(t).children().map((e,t)=>{var a=$(t).attr("id"),r=(a&&$(t).attr("id",a.replace(...n)),$(t).attr("data-parent")),r=(r&&$(t).attr("data-parent",r.replace(...o)),$(t).attr("for")),r=(r&&$(t).attr("data-parent",r.replace(...n)),$(t).attr("aria-describedby"));return r&&$(t).attr("aria-describedby",a.replace(...n)),t}),t}),e.after(t.prop("outerHTML")),$("button.repeat").off("click",n).on("click",n)}function i(e,t=""){$("#modalLabel").html('<span class="badge rounded-pill text-bg-danger">Error</span>'+(t||"")),$("#modalBody>textarea").val(e),new bootstrap.Modal("#modal").show()}function t(r){return new Promise((t,e)=>{var a=new FileReader;a.addEventListener("error",()=>{console.error("Error occurred reading file: "+r.name),e("Error occurred reading file: "+r.name)}),a.addEventListener("load",e=>{t(e.target.result)}),a.readAsText(r)})}e.addEventListener("dragover",e=>{e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"}),e.addEventListener("drop",async e=>{e.stopPropagation(),e.preventDefault();var e=e.dataTransfer.files;0<e.length&&((e=await t(e[0]).then(e=>e).catch(e=>(console.log(e),i(e),!1)))?r(e):i("The file content is empty!"))}),$("#readTemplateFile")[0].addEventListener("change",async e=>{0!==e.target.files.length&&((e=await t(e.target.files[0]).then(e=>e).catch(e=>(console.error(e),i(e),!1)))?r(e):i("The file content is empty!"))}),$("#loadRemoteFile").click(async e=>{var t=$("#remote-url").val();t&&($(e.target).attr("disabled","disabled").html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>Loading...'),await a(t),$(e.target).text("Generator").removeAttr("disabled"))})})();